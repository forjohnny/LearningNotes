# 几串口协议的整理

转载自博客园的一篇博客[几个串口协议学习整理](http://www.cnblogs.com/chineseboy/p/5226961.html)

一、UART

UART是一个大家族，其包括了RS232、RS499、RS423、RS422和RS485等接口标准规范和总线标准规范。它们的主要区别在于其各自的电平范围不相同。

嵌入式设备中常常使用到的是TTL、TTL转RS232的这种方式。常用的就三根引线：发送线TX、接收线RX、电平参考地线GND。

 1.1    电路示意图

 ![img](image\UART连线示意图.png)

1.2    通信协议

将传输数据的每个字符一位接一位地传输。

![串口数据传输示意图.png](image\串口数据传输示意图.png)

起始位：先发出一个逻辑”0”的信号，表示传输字符的开始。

数据位：紧接着起始位之后。数据位的个数可以是4、5、6、7、8等，构成一个字符。通常采用ASCII码。

奇偶校验位：数据位加上这一位后，使得“1”的位数应为偶数(偶校验)或奇数(奇校验)，以此来校验资料传送的正确性。

停止位：它是一个字符数据的结束标志。可以是1位、1.5位、2位的高电平。

空闲位：处于逻辑“1”状态，表示当前线路上没有资料传送。

波特率：数据传输的速率。有以下几个档位：300、600、1200、2400、4800、9600、19200、38400、43000、56000、57600、115200.当然也可以自定义。在数据传输和接收双方，需要预先统一波特率，以便正确的传输数据。

二、I2C 总线

2.1 电路示意图

**I²C** (**Inter-Integrated Circuit**)。其拥有一根数据线SDA和一根时钟线SCL。其总线通过上拉电阻与电源相连接。每个接到I2C总线上的器件都有唯一的地址。其中，主动发起操作的一方为主机，另外一方为从机。

![IIC 总线](image\IIC 总线电路示意图.png)

2.2 数据传输

当没有数据传输的时候，两根总线都为高电平；当采集IIC上的数据时，其时钟线SCL必须是高电平且SDA的数据必须保持稳定不变---将SDA的电平与SCL的高电平进行“与”操作后，以便确定SDA上是1还是0；在SCL为低电平的时候，SDA上的数据可以进行跳变。

数据传输开始时，需要发送一个起始信号；数据传输结束后，需要发送一个终止信号；每8bit数据传输结束，都需要一个ACK。起止信号都有Master发出，而ACK则可能由Master或者SLAVE来发出。数据的传输采用大端传输。

开始信号：SCL为高电平，SDA的电平由高跳到低表示开始信号。

终止信号：SCL为高电平，SDA的电平由低跳到高表示终止信号。

![IIC时序](image\IIC总线时序图.png)

2.3 数据协议

![IIC数据协议](image\IIC数据协议.png)

2.4   I2C读写流程

![I2C读写流程](image\I2C读写流程.png)



![I2C写寄存器的标准流程.png](image\I2C写寄存器的标准流程.png)



![I2C写寄存器的标准流程.png](image\I2C读寄存器的标准流程.png)

三、SPI总线

SPI（Serial Peripheral Interface）是一种串行串行同步通讯协议，由一个主设备和一个或多个从设备组成。其拥有四根(类)硬脚引线，分别为 SDI（串行数据输入），SDO（串行数据输出），SCK（串行移位时钟），CS（片选）。因为一个主设备可以挂多个从设备，则通过片选引脚对从设备进行选择。从设备的工作时钟则是来自于主设备的SCK线。

3.1 电路示意图

![SPI总线](image\SPI总线电路示意图.png)



3.2 数据的传输

SPI在数据传输的时候，需要确定两件事情：其一，数据是在时钟的上升沿采集还是下降沿采集；其二，时钟的初始(空闲)状态是为高电平还是低电平。而I2C的空闲状态，时钟线为高电平；数据采集的时候，时钟线也为高电平。但SPI给出了更自由的方式。

CPOL：时钟极性, 表示 SPI 在空闲时, 时钟信号是高电平还是低电平。

CPHA：时钟相位, 表示 SPI 设备是在 SCK 管脚上的时钟信号变为上升沿时触发数据采样, 还是在时钟信号变为下降沿时触发数据采样。

那么，SPI CPOL有两种可能，CPHA有两种可能，则SPI数据传输就有四种可能---按照标准的说法，SPI数据传输就有四种模式。

![SPI数据传输就有四种模式](image\SPI数据传输就有四种模式.png)

![SPIMode0.png](image\SPIMode0.png)



![SPIMode1.png](image\SPIMode1.png)

![SPIMode2.png](image\SPIMode2.png)



3.3 SPI读写

SPI在硬件设计上采用的双数据线制，根据设计，在SPI通信过程中，主从设备之间会形成一个数据环形链路---也即是，主设备向从设备写一次数据，从设备就会回一次数据(至于该从设备回复的数据是否有效，则另当别论---如果有效，主设备就把它读入；如果无效，则丢弃即可)。

![SPI主从连接.png](image\SPI主从连接.png)

![SPI读写.png](image\SPI读写.png)



